<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="communicationMapper">

    <select id="showContent" parameterType="PageData" resultType="PageData">
     select nick_name,avatar_url,id,content,date_format(RequestMapping,"%Y-%m-%d %T") as addtime,browse_num,comment_num,zan_num
     from tb_content a join users b on a.openid=b.openid order by addtime desc
    </select>

    <select id="showComment" parameterType="PageData" resultType="PageData">
     select nick_name,avatar_url,dtid,plid,hfid,a.openid,content,zan_num,comment_num,date_format(addtime,"%Y-%m-%d %T") as addtime
     from (select * from tb_comment where dtid=#{dtid})as a left join users b on a.openid=b.openid  order by addtime desc
    </select>

    <select id="completeComment" parameterType="PageData" resultType="PageData">
     select nick_name as nick_name2 ,avatar_url as avatar_url2
     from (select * from tb_comment where plid=#{hfid})as a left join users b on a.openid=b.openid
    </select>

    <select id="showReply" parameterType="PageData" resultType="PageData">
     select nick_name,avatar_url,dtid,plid,hfid,a.openid,content,zan_num,comment_num,date_format(addtime,"%Y-%m-%d %T") as addtime
     from (select * from tb_comment where dtid=#{plid})as a left join users b on a.openid=b.openid
    </select>

    <select id="showImage" parameterType="PageData" resultType="java.lang.String">
     select url from tb_image where content_id=#{id}
    </select>

    <insert id="addContent" parameterType="PageData">
     insert into tb_content(id,openid,content,addtime,zan_num,browse_num,comment_num)
     values (#{id},#{openid},#{content},#{addtime},0,0,0)
    </insert>

    <insert id="addImage" parameterType="PageData">
     insert into tb_image(content_id,url)
     values (#{content_id},#{url})
    </insert>

    <insert id="addComment" parameterType="PageData">
     insert into tb_comment(dtid,plid,hfid,openid,content,zan_num,comment_num,addtime)
     values (#{dtid},#{plid},#{hfid},#{openid},#{content},0,0,#{addtime})
    </insert>



</mapper>